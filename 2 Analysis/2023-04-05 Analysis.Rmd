---
title: "Analysis"
author: "Dan Aurell"
date: "2023-04-05"
output:   
  html_document: 
    keep_md: yes
---

# Setup

```{r}
library(MASS)
library(tidyverse)
library(lme4)
library(boot)
library(emmeans)
library(broom)
library(DHARMa)
```

Vector of queen events
```{r}
# From "collated qlessness" sheet

# Any colonies that became queenless between day 0 and 42
qless <- c("D8", "RC1", "D21", "D24", "C6", "BC15")

```

```{r}
datum <- read.csv("../2 Analysis/data_prepped/datum_prepped.csv")
```

```{r, include=FALSE}
datum$trt <- factor(datum$trt , levels=c("Apivar", "Apiguard_Api", "AEC"))
# datum$trt <- factor(datum$trt , levels=c("Apiguard_Api", "AEC", "Apivar"))

# So that days is treated as categorical in models
datum$days <- factor(datum$days)
```

Data prep for phor, infest, bees modeling
```{r}
tempdatum <- datum %>% 
  filter(days %in% c(0,21,42),
         !(col_no %in% qless)
         ) %>%
  mutate(tot = wk_cells_infested_estimate + phoretic_mites_num_estimate,
           perc_of_mitepop_wkbrd = 100*wk_cells_infested_estimate/tot
           )
```

Very simple descriptive stats desired for text
```{r}
mean(tempdatum$bees_frames[tempdatum$days == 0])

```


# Treatment Effects on Varroa Infestation
## Varroa on adult bees

### Poisson vs. Negative Binomial

Checking for overdispersion - 
```{r}
dispersionstats <- datum %>%
    filter(days %in% c(0,21,42),
         !(col_no %in% qless)) %>% 
 summarise(
 means = mean(mites_recov_total),
 variances = var(mites_recov_total),
 ratio = variances/means)

# Variance-to-mean ratio of 22; use negative binomial distribution instead of Poisson
```


Fit Poisson and negative binomial models
```{r}
m.phor.pois1 <- glmer(mites_recov_total ~ 
                     trt + 
                     days + 
                     trt:days + 
                     (1 | col_no), 
                   data = tempdatum, family = poisson)


m.phor.nb1 <- glmer.nb(mites_recov_total ~ 
                     trt + 
                     days + 
                     trt:days + 
                     (1 | col_no), 
                   data = tempdatum)

summary(m.phor.pois1)
summary(m.phor.nb1)

```


Plot residuals and see if it's zero-inflated.

```{r}

```

Comparing nb to poisson with deviance F-test
```{r}
# Test whether nb is a stat sig better fit than poisson:
anova(m.phor.nb1, m.phor.pois1)
# Yes, highly significantly better (p<2.2e-16)

summary(m.phor.pois1)$coefficients
summary(m.phor.nb1)$coefficients
# The p values for my predictors went up, but the fit is way better
  # This makes sense... Poisson is not conservative enough with overdispersed data
# The parameter estimates stay pretty much the same. Good.
```

### Fit model that uses number of bees in sample as the offset

```{r}
# A priori model
m.phor.nb1 <- glmer.nb(mites_recov_total ~ 
                     trt + 
                     days + 
                     trt:days + 
                     (1 | col_no), 
                   data = tempdatum)
summary(m.phor.nb1)

# Take into account the number of bees per sample

m.phor <- glmer.nb(mites_recov_total ~ 
                     trt + 
                     days + 
                     trt:days + 
                     offset(log(est_bee_num_by_wt_floor)) +
                     (1 | col_no),
                   data = tempdatum)
summary(m.phor) # Very different coefficients... because varroa per bee rather than per sample...
  # Check on this interpretation

# What's the mean of the offset? 
mean(tempdatum$est_bee_num_by_wt_floor) 
# 321.3
# To express model estimates as number of Varroa per 100 bees, take
  # yvar*100/321.3



# Test significance of trt:days interaction

## Fit model that omits trt:days interaction

m.phor.0 <- glmer.nb(mites_recov_total ~ 
                     trt + 
                     days + 
                     # trt:days + 
                     offset(log(est_bee_num_by_wt_floor)) +
                     (1 | col_no),
                   data = tempdatum)
summary(m.phor.0)

anova(m.phor, m.phor.0) 
# There was a significant interaction between day and treatment (p=2.375e-05) when tested by ANOVA. Therefore we analyzed each date separately.
```


## Infestation of Brood

Checking for overdispersion
```{r}
dispersionstats2 <- datum %>%
    filter(days %in% c(0,21,42),
         !(col_no %in% qless)) %>% 
 summarise(
 means = mean(infest_200, na.rm = T),
 variances = var(infest_200, na.rm = T),
 ratio = variances/means)

# Variance-to-mean ratio of 14; use negative binomial distribution instead of Poisson
```

```{r}
# a priori model
m.infest.nb1 <- glmer.nb(infest_200 ~ 
                     trt + 
                     days + 
                     trt:days + 
                     (1 | col_no),
                   data = tempdatum)
summary(m.infest.nb1)

m.infest.nb0 <- glmer.nb(infest_200 ~ 
                     trt + 
                     days + 
                     # trt:days + 
                     (1 | col_no),
                   data = tempdatum)

anova(m.infest.nb1, m.infest.nb0)

```


## Proportion of Varroa population in brood vs. adults

Data prep
```{r}
tempdatum <- datum %>% 
  filter(days %in% c(0,21,42),
         !(col_no %in% qless)
         ) %>%
  mutate(tot = wk_cells_infested_estimate + phoretic_mites_num_estimate,
           perc_of_mitepop_wkbrd = 100*wk_cells_infested_estimate/tot
           )

```


A) In colonies with drone brood, what proportion of the mites are in drone brood? I.e., can we safely ignore it?
```{r}
datum %>% 
  filter(!is.na(dr_cells_infested_estimate)) %>% 
  select(dr_cells_infested_estimate, mites_total_estimate) %>% 
  mutate(perc_of_mitepop_in_drone = 100*dr_cells_infested_estimate/mites_total_estimate)

datum %>% 
  filter(!is.na(dr_cells_infested_estimate)) %>% 
  select(dr_cells_infested_estimate, mites_total_estimate) %>% 
  mutate(perc_of_mitepop_in_drone = 100*dr_cells_infested_estimate/mites_total_estimate) %>% 
  summarize(mean = mean(perc_of_mitepop_in_drone),
            sd = sd(perc_of_mitepop_in_drone),
            min = min(perc_of_mitepop_in_drone),
            max = max(perc_of_mitepop_in_drone)
  )
# On Day 0, only 4.8% of mite population was in drone brood... even for the colonies where we were able to measure it. That's small enough to just ignore the column - 
# - and do the analysis only on the number of mites i
```

B) How does the proportion of mites in worker brood vs. on adult bees vary through the season?
```{r}
tempdatum %>% 
  group_by(days) %>% 
  summarize(mean = mean(perc_of_mitepop_wkbrd, na.rm = T))
# I would have expected that by the end, most mites would be "phoretic" since there's so little brood. Still 60% at the end.

tempdatum %>% 
  group_by(days, trt) %>% 
  summarize(mean = mean(perc_of_mitepop_wkbrd, na.rm = T))
# It does seem to vary between treatments in an interesting way
```



Plot proportion of Varroa population in brood vs. adults
```{r}
tempdatum %>% 
  ggplot(mapping = aes(y = perc_of_mitepop_wkbrd, x = days, color = trt)) +  
  # , group = trt probably not necessary
  scale_fill_manual(
    limits = c("Apivar", "AEC", "Apiguard_Api"),
    labels = c("Apivar", "Amitraz E.C.", "Combination"),
    values = c("black", "white", "#00BA38"), 
    aesthetics = "fill"
  ) +
  geom_jitter() +
  scale_y_continuous(limits = c(0,100))



```

Analyze proportion of Varroa population in brood vs. adults

```{r}
dispersionstats <- tempdatum %>%
 summarise(
 means = mean(perc_of_mitepop_wkbrd, na.rm = T),
 variances = var(perc_of_mitepop_wkbrd, na.rm = T),
 ratio = variances/means)

# Variance-to-mean ratio of 5.2; use negative binomial distribution instead of Poisson
```

```{r}
# This is a first try at analyzing the proportion of mites that are in the reproductive phase. I know it is not technically correct, since it assumes an unbounded distribution but in this case it is bounded by 0 and 100.

# Also, the model fit for the null model is singular

m.perc_mitepop_wkbrd <- lmer(perc_of_mitepop_wkbrd ~ 
                   trt + 
                   days + 
                   trt:days + 
                  (1 | col_no), 
                 data = tempdatum)
summary(m.perc_mitepop_wkbrd)

emmip(m.perc_mitepop_wkbrd, trt~days, type = "response", CIs = TRUE)

m.perc_mitepop_wkbrd.ML <- lmer(perc_of_mitepop_wkbrd ~ 
                   trt + 
                   days + 
                   trt:days + 
                  (1 | col_no), 
                 data = tempdatum, REML = FALSE)

m.perc_mitepop_wkbrd.0.ML <- lmer(perc_of_mitepop_wkbrd ~ 
                   trt + 
                   days + 
                   # trt:days + 
                  (1 | col_no), 
                 data = tempdatum, REML = FALSE) # The model fit is singular
summary(m.perc_mitepop_wkbrd.0.ML)

anova(m.perc_mitepop_wkbrd.ML, m.perc_mitepop_wkbrd.0.ML)
# The more complex model is preferred
```

```{r}
# Make negative binomial model

m.prop <- glmer.nb(wk_cells_infested_estimate ~ 
                     trt + 
                     days + 
                     trt:days + 
                     offset(log(tot)) +
                     (1 | col_no),
                   data = tempdatum)

summary(m.prop)

mean(tempdatum$tot, na.rm = T)

emres_prop <- emmeans(m.prop, pairwise ~ trt | days, type = "response")$emmeans %>% 
  tidy() 


emres_prop %>% 
  mutate(
    perc_brood = response*100/1803.982
  ) %>%
  select(trt, days, response, perc_brood, everything())



      
```

tempdatum$tot

phoretic_mites_num_estimate
    wk_cells_infested_estimate
    dr_cells_infested_estimate
    mites_total_estimate


Summarize proportion of Varroa population in brood vs. adults

```{r}
# For statistical statements
emmeans(m.perc_mitepop_wkbrd, pairwise ~ trt | days, type = "response")$contrasts
confint(emmeans(m.perc_mitepop_wkbrd, pairwise ~ trt | days, type = "response"))$contrasts

# For plotting
emplot_percent <- emmip(m.perc_mitepop_wkbrd, trt~days, type = "response", CIs = TRUE, plotit = FALSE)
emplot_percent$days <- as.numeric(as.character(emplot_percent$days))
emplot_percent$trt <- factor(emplot_percent$trt, levels = c("Apivar", "AEC", "Apiguard_Api"))

```



# Treatment Effects on Colony Strength
## Adult Bee Population

```{r}
tempdatum <- datum %>% 
  filter(days %in% c(0,21,42),
         !(col_no %in% qless)
         ) %>%
  mutate(tot = wk_cells_infested_estimate + phoretic_mites_num_estimate,
           perc_of_mitepop_wkbrd = 100*wk_cells_infested_estimate/tot
           )

# A priori model
m.bee1 <- lmer(bees_frames ~ 
                 trt + 
                 days + 
                 trt:days + 
                 pre_phor2 + 
                 pre_phor2:days +
                 (1 | col_no), data = tempdatum)
summary(m.bee1)


m.bee1.ML <- lmer(bees_frames ~ 
                 trt + 
                 days + 
                 trt:days + 
                 pre_phor2 + 
                 pre_phor2:days +
                 (1 | col_no), data = tempdatum, REML = F)

# Omitting the phor:days interaction
m.bee0.ML <- lmer(bees_frames ~ 
                 trt + 
                 days + 
                 trt:days + 
                 pre_phor2 + 
                 # pre_phor2:days +
                 (1 | col_no), data = tempdatum, REML = F)
anova(m.bee0.ML, m.bee1.ML)
# Significant effect of mite level... high-mite colonies shrink during successive dates of trial

# Omitting the phor:days interaction
m.bee00.ML <- lmer(bees_frames ~ 
                 trt + 
                 days + 
                 trt:days + 
                 # pre_phor2 + 
                 # pre_phor2:days +
                 (1 | col_no), data = tempdatum, REML = F)
anova(m.bee00.ML, m.bee0.ML)


# Second reduced model omitting the trt:days interaction
m.bee000.ML <- lmer(bees_frames ~ 
                 trt + 
                 days + 
                 # trt:days + 
                 pre_phor2 + 
                 pre_phor2:days +
                 (1 | col_no), data = tempdatum, REML = F)
anova(m.bee000.ML, m.bee1.ML)
# Significant trt:days interaction

# True a priori model
m.bee.apriori.ML <- lmer(bees_frames ~ 
                 trt + 
                 days + 
                 trt:days +
                 (1 | col_no), data = tempdatum, REML = F)

m.bee.apriori0.ML <- lmer(bees_frames ~ 
                 trt + 
                 days + 
                 # trt:days +
                 (1 | col_no), data = tempdatum, REML = F)

anova(m.bee.apriori.ML, m.bee.apriori0.ML)

# Save REML version
m.bee.apriori <- lmer(bees_frames ~ 
                 trt + 
                 days + 
                 trt:days +
                 (1 | col_no), data = tempdatum, REML = F)

```


## Population of capped worker brood

```{r}
tempdatum <- datum %>% 
  filter(days %in% c(0,10,21,42),
         !(col_no %in% qless)
         )
```


```{r}
m.brood1 <- lmer(wk_frames ~ 
                   trt + 
                   days + 
                   trt:days + 
                   pre_phor2 +
                   pre_phor2:days +
                  (1 | col_no), 
                 data = tempdatum)
summary(m.brood1)

m.brood1.ML <- lmer(wk_frames ~ 
                   trt + 
                   days + 
                   trt:days + 
                   pre_phor2 +
                   pre_phor2:days +
                  (1 | col_no), 
                 data = tempdatum, REML = F)
summary(m.brood1.ML)

# Omit pre_phor2:days effect
m.brood01.ML <- lmer(wk_frames ~ 
                   trt + 
                   days + 
                   trt:days + 
                   pre_phor2 +
                   # pre_phor2:days +
                  (1 | col_no), 
                 data = tempdatum, REML = F)
summary(m.brood01.ML)
anova(m.brood01.ML, m.brood1.ML) # Simpler model preferred, but just barely (p=0.07395)


# Full model minus the trt:days interaction
m.brood02.ML <- lmer(wk_frames ~ 
                   trt + 
                   days + 
                   # trt:days + 
                   pre_phor2 +
                   pre_phor2:days +
                  (1 | col_no), 
                 data = tempdatum, REML = F)
summary(m.brood02.ML)

anova(m.brood02.ML, m.brood1.ML)
# Weak evidence for a brood:days interaction (p=0.07737) in the presence of the pre_phor stuff

# Omit trt:days in the context of pre_phor 2 main effect
m.brood04.ML <- lmer(wk_frames ~ 
                   trt + 
                   days + 
                   # trt:days + 
                   pre_phor2 +
                   # pre_phor2:days +
                  (1 | col_no), 
                 data = tempdatum, REML = F)
anova(m.brood04.ML, m.brood01.ML)
# Again, trt:days effect not quite significant (p=0.0962)


# Omit pre_phor2
m.brood05.ML <- lmer(wk_frames ~ 
                   trt + 
                   days + 
                   trt:days + 
                   # pre_phor2 +
                   # pre_phor2:days +
                  (1 | col_no), 
                 data = tempdatum, REML = F)
anova(m.brood05.ML, m.brood01.ML)


# Omit trt:days in the context of pre_phor 2 main effect
m.brood06.ML <- lmer(wk_frames ~ 
                   trt + 
                   # days + 
                   # trt:days + 
                   pre_phor2 +
                   # pre_phor2:days +
                  (1 | col_no), 
                 data = tempdatum, REML = F)
anova(m.brood06.ML, m.brood04.ML)
# Again, days effect significant (p<0.0001)

# Preferred model: m.brood01.ML
# Make REML version
m.brood01 <- lmer(wk_frames ~ 
                   trt + 
                   days + 
                   trt:days + 
                   pre_phor2 +
                   # pre_phor2:days +
                  (1 | col_no), 
                 data = tempdatum)

summary(m.brood01)
confint(m.brood01)


```






# Summarize Varroa and bee population models to make comparisons

```{r}
# Phor

# Res = "response" so that I can get estimated values for the text.
emres_phor<- emmeans(m.phor, pairwise ~ trt | days, type = "response")$emmeans %>% 
  tidy() %>% 
  mutate(
    varper100 = response*100/321.3
  ) %>%
  select(trt, days, response, varper100, everything())

emmeans(m.phor, pairwise ~ trt | days, type = "response")$contrasts
confint(emmeans(m.phor, pairwise ~ trt | days, type = "response"))$contrasts

## Over time
emmeans(m.phor, pairwise ~ days | trt, type = "response")$contrasts

# Infest

emres_infest<- emmeans(m.infest.nb1, pairwise ~ trt | days, type = "response")$emmeans %>% 
  tidy() %>% 
  mutate(
    infestper100 = response/2
  ) %>%
  select(trt, days, response, infestper100, everything())

emmeans(m.infest.nb1, pairwise ~ trt | days, type = "response")$contrasts
confint(emmeans(m.infest.nb1, pairwise ~ trt | days, type = "response"))$contrasts

## Over time
emmeans(m.infest.nb1, pairwise ~ days | trt, type = "response")$contrasts

# Bees

emres_bees<- emmeans(m.bee1, pairwise ~ trt | days, type = "response")$emmeans %>% 
  tidy()

emmeans(m.bee1, pairwise ~ trt | days, type = "response")$contrasts
confint(emmeans(m.bee1, pairwise ~ trt | days, type = "response"))$contrasts

## Day 42 frames of bees estimates
### AEC 4.292991
### Apivar 2.912365
### Combination 2.951125

## What percentage of bees were lacking in Apivar?
100*(4.292991-2.912365)/4.292991 #32%

# 1.38 missing frames of bees. Convert to number of bees
# Beebook reference
2430*1.38 # 3353

## What percentage of bees were lacking in Combination?
100*(4.292991-2.951125)/4.292991 # 31%

## Combination missing 1.34 frames of bees. Convert to number of bees
## Beebook conversion
2430*1.34 # 3256 bees missing


## Combination missing how many frames of brood on Day 10?
1.2-0.73 # 0.47 frames of brood


880*3.8*2 # 6688 cells of worker brood per frame

## Combination missing 0.47 frames of brood on Day 10. Convert to number of bees
6688*0.47 #3143 brood missing








## Over time
emmeans(m.bee1, pairwise ~ days | trt, type = "response")$contrasts

# Bees a priori

emres_bees_apriori<- emmeans(m.bee.apriori, pairwise ~ trt | days, type = "response")$emmeans %>% 
  tidy()

emmeans(m.bee.apriori, pairwise ~ trt | days, type = "response")$contrasts
confint(emmeans(m.bee.apriori, pairwise ~ trt | days, type = "response"))$contrasts

# Brood



emres_brood<- emmeans(m.brood01, pairwise ~ trt | days, type = "response")$emmeans %>% 
  tidy()

emmeans(m.brood01, pairwise ~ trt | days, type = "response")$contrasts
confint(emmeans(m.brood01, pairwise ~ trt | days, type = "response"))$contrasts
# Note that we have a significant comparison here even though the inclusion of day:trt effect in the overall model was not significant.
```

# Dynamics of Varroa Infestation in Colonies Treated with Amitraz E.C.

```{r}
emmeans(m.phor, pairwise ~ days | trt, type = "response")$contrasts

1/32.4498
1/0.0844


confint(emmeans(m.phor, pairwise ~ days | trt, type = "response"))$contrasts

# 0-21 95% CI
1/71.142
1/14.8011

# 21-42 95% CI
1/0.185
1/0.0385

```




# Effects of Varroa on Colony Strength

# Effects on Long-Term Colony Survival and Colony Condition

# Summarize models for plotting
```{r}
emplot_phor <- emmip(m.phor, trt~days, type = "response", CIs = TRUE, plotit = FALSE)
emplot_phor$days <- as.numeric(as.character(emplot_phor$days))
emplot_phor$trt <- factor(emplot_phor$trt, levels = c("Apivar", "AEC", "Apiguard_Api"))
levels(emplot_phor$trt) # check order of factors

emplot_infest <- emmip(m.infest.nb1, trt~days, type = "response", CIs = TRUE, plotit = FALSE)
emplot_infest$days <- as.numeric(as.character(emplot_infest$days))
emplot_infest$trt <- factor(emplot_infest$trt, levels = c("Apivar", "AEC", "Apiguard_Api"))
levels(emplot_infest$trt) # check order of factors

emplot_bees <- emmip(m.bee1, trt~days, type = "response", CIs = TRUE, plotit = FALSE)
emplot_bees$days <- as.numeric(as.character(emplot_bees$days))
emplot_bees$trt <- factor(emplot_bees$trt, levels = c("Apivar", "AEC", "Apiguard_Api"))
levels(emplot_bees$trt) # check order of factors

emplot_bees_apriori <- emmip(m.bee.apriori, trt~days, type = "response", CIs = TRUE, plotit = FALSE)
emplot_bees_apriori$days <- as.numeric(as.character(emplot_bees_apriori$days))
emplot_bees_apriori$trt <- factor(emplot_bees_apriori$trt, levels = c("Apivar", "AEC", "Apiguard_Api"))
levels(emplot_bees_apriori$trt) # check order of factors

emplot_brood <- emmip(m.brood1, trt~days, type = "response", CIs = TRUE, plotit = FALSE)
emplot_brood$days <- as.numeric(as.character(emplot_brood$days))
emplot_brood$trt <- factor(emplot_brood$trt, levels = c("Apivar", "AEC", "Apiguard_Api"))
levels(emplot_brood$trt) # check order of factors

```

# Save these summarized tables of model estimates to their own CSVs

```{r}
write.csv(emplot_phor, "../3 Plotting/data_analyzed/emplot_phor.csv")
write.csv(emplot_infest, "../3 Plotting/data_analyzed/emplot_infest.csv")
write.csv(emplot_bees, "../3 Plotting/data_analyzed/emplot_bees.csv")
write.csv(emplot_bees_apriori, "../3 Plotting/data_analyzed/emplot_bees_apriori.csv")
write.csv(emplot_brood, "../3 Plotting/data_analyzed/emplot_brood.csv")
write.csv(emplot_percent, "../3 Plotting/data_analyzed/emplot_percent.csv")
```


# Colony metrics comparisons

## Modeling overall colony size (adult bees + capped brood)

First graph the relationship between bees and brood
- There is a very tight relationship
- This makes sense: bees raise brood; also there's a an underlying factor: the queen's laying rate influences both the number of bees and brood
```{r}
datum %>% 
  filter(days %in% c(0,21,42, 138),
         !(col_no %in% qless)
         ) %>% 
  ggplot(aes(x = bees, y = cap_brd_indiv, color = days)) +
  geom_point() +
  geom_smooth(method = "lm")
  
```


```{r}
tempdatum <- datum %>% 
  filter(days %in% c(0,21,42),
         !(col_no %in% qless)
         ) %>%
  mutate(tot = wk_cells_infested_estimate + phoretic_mites_num_estimate,
           perc_of_mitepop_wkbrd = 100*wk_cells_infested_estimate/tot
           )
```

Modeling the number of total individuals
```{r}
# A priori model
m.indiv1 <- lmer(indiv_total ~ 
                 trt + 
                 days + 
                 trt:days + 
                 pre_phor2 + 
                 pre_phor2:days +
                 (1 | col_no), data = tempdatum)
summary(m.indiv1)

m.indiv1.ML <- lmer(indiv_total ~ 
                 trt + 
                 days + 
                 trt:days + 
                 pre_phor2 + 
                 pre_phor2:days +
                 (1 | col_no), data = tempdatum, REML = F)

# Omit pre_phor2:days
m.indiv01.ML <- lmer(indiv_total ~ 
                 trt + 
                 days + 
                 trt:days + 
                 pre_phor2 + 
                 # pre_phor2:days +
                 (1 | col_no), data = tempdatum, REML = F)

# Omit trt:days
m.indiv02.ML <- lmer(indiv_total ~ 
                 trt + 
                 days + 
                 # trt:days + 
                 pre_phor2 + 
                 pre_phor2:days +
                 (1 | col_no), data = tempdatum, REML = F)

# Omit pre_phor2:days and pre_phor2
m.indiv03.ML <- lmer(indiv_total ~ 
                 trt + 
                 days + 
                 trt:days + 
                 # pre_phor2 + 
                 # pre_phor2:days +
                 (1 | col_no), data = tempdatum, REML = F)

anova(m.indiv01.ML, m.indiv1.ML) # pre_phor2:days not significant (p=0.09406)
anova(m.indiv02.ML, m.indiv1.ML) # trt:days not significant (p=0.09803)
anova(m.indiv03.ML, m.indiv01.ML) # The effect of phor on the number of individuals was highly significant (6.315e-06)


# This is a well-supported model
m.indiv01 <- lmer(indiv_total ~ 
                 trt + 
                 days + 
                 trt:days + 
                 pre_phor2 + 
                 # pre_phor2:days +
                 (1 | col_no), data = tempdatum)
summary(m.indiv01)
# I'm noticing high variance. 15 million for the random effect
# What does this mean? Do I have it in my other models?
# The SE for each estimate tends to be around the same size as the estimate itself.


```

## Proportion brood vs. adult bees each date?
```{r}
datum %>% 
  filter(days %in% c(0,21,42, 138),
         !(col_no %in% qless)) %>% 
  group_by(days) %>% 
  summarise(percent_broodpop = mean(indiv_capbrd_pct, na.rm = T))
# Approximately 40-60% of individuals at any time were brood

```

## Brood:bees ratio per treatment

```{r}
# What about per time point and treatment?
datum %>% 
  filter(days %in% c(0,21,42, 138),
         !(col_no %in% qless)) %>% 
  group_by(days, trt) %>% 
  summarise(percent_broodpop = mean(indiv_capbrd_pct, na.rm = T))
# There's an interesting (biologically large) difference in brood:bees ratio between treatments on Day 138


```

```{r}
datum %>% 
  filter(days %in% c(138),
         !(col_no %in% qless)
         ) %>% 
  ggplot(aes(x = bees, y = cap_brd_indiv, color = trt)) +
  geom_point() +
  geom_smooth(method = "lm")
  
```


